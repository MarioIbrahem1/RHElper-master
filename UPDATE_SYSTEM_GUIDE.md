# دليل نظام التحديث

هذا الدليل يشرح كيفية استخدام نظام التحديث المخصص للتطبيق، والذي يسمح بتوزيع التحديثات للمستخدمين عبر Firebase Storage.

## كيفية رفع تحديث جديد

### 1. إنشاء ملف JSON للتحديث

يجب إنشاء ملف JSON يحتوي على معلومات التحديث بالتنسيق التالي:

```json
{
  "version": "1.0.1",
  "versionCode": 2,
  "downloadUrl": "https://firebasestorage.googleapis.com/v0/b/road-helper-fed8f.firebasestorage.app/o/Road_Helper_v1.0.1-release.apk?alt=media&token=YOUR_TOKEN",
  "releaseNotes": "تحسينات في الأداء وإصلاح بعض الأخطاء",
  "forceUpdate": false
}
```

حيث:
- `version`: رقم الإصدار الجديد (مثل "1.0.1")
- `versionCode`: رقم الإصدار الرقمي (يجب أن يكون أكبر من الإصدار الحالي)
- `downloadUrl`: رابط تنزيل ملف APK من Firebase Storage
- `releaseNotes`: ملاحظات الإصدار التي ستظهر للمستخدم
- `forceUpdate`: إذا كان `true`، سيتم إجبار المستخدم على التحديث

### 2. رفع ملف APK إلى Firebase Storage

1. قم بإنشاء ملف APK للإصدار الجديد من التطبيق
2. قم بتسجيل الدخول إلى [Firebase Console](https://console.firebase.google.com/)
3. انتقل إلى مشروعك > Storage
4. قم برفع ملف APK إلى المجلد المناسب
5. بعد الرفع، انقر بزر الماوس الأيمن على الملف واختر "Get download URL"
6. انسخ الرابط واستخدمه في ملف JSON للتحديث

### 3. رفع ملف JSON للتحديث إلى Firebase Storage

1. قم برفع ملف JSON للتحديث إلى Firebase Storage باسم `version.json`
2. إذا كنت تستبدل ملفًا موجودًا، فستحتفظ بنفس الرابط
3. إذا كنت ترفع ملفًا جديدًا، فستحتاج إلى تحديث الرابط في التطبيق

## رابط ملف JSON للتحديث

الرابط الحالي لملف JSON للتحديث هو:

```
https://firebasestorage.googleapis.com/v0/b/road-helper-fed8f.firebasestorage.app/o/version.json?alt=media&token=c94e6602-2e9e-4d6f-8b42-c0f9e3a39ea6
```

يمكنك استبدال هذا الرابط في ملف `lib/utils/update_helper.dart` إذا قمت بتغيير موقع ملف JSON.

## كيفية عمل نظام التحديث

1. عند بدء التطبيق، يتم التحقق من وجود تحديثات جديدة.
2. يتم مقارنة رقم الإصدار الحالي للتطبيق مع رقم الإصدار في ملف JSON.
3. إذا كان هناك تحديث جديد (رقم الإصدار في JSON أكبر من رقم الإصدار الحالي)، يتم عرض مربع حوار للمستخدم.
4. يمكن للمستخدم اختيار تنزيل التحديث الآن أو لاحقًا (إلا إذا كان التحديث إجباريًا).
5. يتم أيضًا إرسال إشعار للمستخدم بوجود تحديث جديد.

## ملاحظات هامة

- تأكد من زيادة `versionCode` في ملف JSON عند كل تحديث جديد.
- تأكد من تحديث `version` في ملف `pubspec.yaml` للتطبيق عند إصدار نسخة جديدة.
- يتم التحقق من التحديثات بشكل دوري كل 24 ساعة.
- يمكن للمستخدم التحقق من التحديثات يدويًا من خلال زر في التطبيق (إذا قمت بإضافته).

## استكشاف الأخطاء وإصلاحها

إذا لم تظهر إشعارات التحديث، تحقق من:

1. أن `versionCode` في ملف JSON أكبر من `versionCode` في التطبيق.
2. أن رابط ملف JSON صحيح ويمكن الوصول إليه.
3. أن رابط تنزيل APK صحيح ويمكن الوصول إليه.
4. أن التطبيق لديه أذونات الإنترنت والإشعارات.
